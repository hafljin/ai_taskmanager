# AI要約＋タスク分解アプリ  
## プロジェクト開発ガイドライン（AI向け指示書）

あなた（AIエージェント）は、このプロジェクトに関わるすべてのコード・修正・改善を  
以下に定義された **開発ルール** に従って行ってください。

---

# 1. プロジェクト目的
本アプリは、ユーザーのテキスト入力を  
- AI要約（summary）  
- タスク抽出（tasks）  
へ変換し、構造化表示する Web Application である。

使用技術：
- Next.js 14（App Router）
- TypeScript
- Tailwind CSS
- Google AI Studio（Gemini 2.0 Flash）
- Function Calling

---

# 2. 開発原則（必ず遵守）
1. **最小構成でのシンプルな実装**  
2. **安全性の高い実装（セキュリティ優先）**  
3. **保守性の高いディレクトリ構造**  
4. **TDD（テスト駆動開発）を意識した関数分割**  
5. **型安全（TypeScript Strict）を徹底**  
6. **コメントは必要最低限で“意図”を明記**  
7. **レスポンシブ＋アクセシビリティ考慮**  
8. **AI API Key は絶対にフロントへ露出させない**  
9. **拡張に強い設計（縦特化AIへの発展を考慮）**

---

# 3. セキュリティガイドライン
以下を必ず守る：

### ● APIキー管理  
- `.env` のみ  
- `NEXT_PUBLIC_` を絶対に使わない  
- `process.env.GEMINI_API_KEY` はサーバー側限定

### ● APIリクエスト制御  
- `POST` のみ  
- body のバリデーション必須  
- 型チェックを行う  
- エラーハンドリングを強化（400 / 500）

### ● 出力サニタイズ  
- 画面表示時に XSS 対策  
- AIが返す文字列はそのまま危険と想定

### ● レートリミット（簡易版）  
- 今すぐ実装不要だが、構造は追加できる形にすること

---

# 4. TDD（テスト駆動）ルール
本プロジェクトでは以下を徹底する：

### ● UIロジック／サーバーロジックを分離  
- 機能（ビジネスロジック）は関数化  
- テストしやすい粒度に分割  
- `lib/` 下にロジックを集約

### ● 最低限のテスト  
以下のテストは必須：
- 入力が空の場合のバリデーション  
- APIレスポンスの型チェック  
- エラーハンドリングのテスト  
- タスク分解・summaryのnullガード処理

（テスト用ファイル例）
```
__tests__/
  api.test.ts
  parser.test.ts
  validation.test.ts
```

※ TDD完璧でなくてよい。  
**「テストできるように実装を分離」することが最重要。**

---

# 5. 機能ルール
### 5-1. 入力
- textarea（最大5000文字）
- 空入力はエラー

### 5-2. 処理
- Function Calling で構造化出力  
- `lib/gemini.ts` に処理集約

### 5-3. 出力UI
- summary → カード  
- tasks → チェック付きリスト（UIはシンプルで良い）

---

# 6. ディレクトリ構造（標準形）
以下の形を必ず守る：

```
app/
  page.tsx
  api/
    summarize/
      route.ts
components/
  Loading.tsx
  ResultCard.tsx
lib/
  gemini.ts
  validators.ts
  parser.ts
__tests__/
  api.test.ts
  parser.test.ts
  validation.test.ts
styles/
  globals.css
```

---

# 7. コード生成ルール（AIへの厳密指示）
AIエージェントは以下を厳守：

- 関数は「単一責任原則（SRP）」で分割  
- 型定義（TypeScript）を必ず先に書く  
- ロジックは `lib/xxx.ts` に集中  
- フロントには「表示」「操作」以外の処理を書かない  
- APIは必ず `POST`  
- `route.ts` 内ではロジックを書かず、libの関数を呼ぶだけの構造にする  
- UIは読みやすさ重視（過コンポーネント化しない）

---

# 8. READMEルール  
READMEには以下を必ず書く：

- プロジェクト概要  
- 技術構成  
- 構造化出力仕様（summary / tasks）  
- ローカル実行方法  
- デプロイ方法（Vercel）  
- セキュリティ注意点  
- 今後の拡張（縦特化AI化）

---

# 9. 今後の拡張を見据えたルール
本アプリは将来的に以下を追加する可能性がある：

- 業界特化（整骨院／美容院／不用品回収など）  
- カスタムプロンプト  
- ユーザー保存（SaaS化）  
- 課金システム（Stripe）

追加する際も  
**現状の構造を崩さない前提で設計すること**。

---

# 10. AIエージェントへの初回指示
あなた（AI）は次の順番で動作を開始する：

1. このガイドラインの理解を確認する  
2. 現在のプロトタイプとの差分を分析し、必要な追加ファイルをリスト化  
3. 不足部分を補うコードを生成（TDDを意識）  
4. セキュリティルールに沿って改善提案を返す  
5. 最終的にプロジェクトを保守可能な形へ仕上げる  

---
